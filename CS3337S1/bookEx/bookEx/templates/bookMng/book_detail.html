{% extends "base.html" %}
{% load static %}

{% block sidenav %}
   {% for item in item_list %}
      <li>
        <a href="{{ item.link }}">  {{ item.item }} </a>
      </li>
   {% endfor %}
{% endblock sidenav %}

{% block content %}
   <h1>Book Detail</h1>
   <table border="2" >
      <tr>
          <th>
              Book Picture
          </th>
          <th>
              Book Name
          </th>
          <th>
              Book Price
          </th>
          <th>
              User Name
          </th>
          <th>
              Book Post Date
          </th>
          <th>
              Book Web
          </th>
      </tr>
       <tr>
         <td>
           <img src="{% static book.pic_path %}" width="100" />
         </td>
         <td>
            {{ book.name }}
         </td>
         <td>
            {{ book.price }}
         </td>
          <td>
            {{ book.username }}
         </td>
           <td>
            {{ book.publishdate }}
         </td>
         <td>
               {{ book.web }}
         </td>
      </tr>
   </table>

    {% if user.is_authenticated %}
  <form action="{% url 'toggle_favorite' book_id=book.id %}" method="post" style="margin-top: 20px;">
    {% csrf_token %}
    <button type="submit" style="
      padding: 10px 16px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: {% if is_favorite %}#ffe6e6{% else %}#e6f0ff{% endif %};
      color: {% if is_favorite %}#cc0000{% else %}#003366{% endif %};
      transition: 0.3s;
    ">
      {% if is_favorite %}
        ‚ù§Ô∏è Favorited ‚Äî Click to Remove
      {% else %}
        ü§ç Add to Favorites
      {% endif %}
    </button>
  </form>
{% else %}
  <p><a href="{% url 'login' %}?next={% url 'book_detail' book.id %}">Log in</a> to add this book to your favorites.</p>
{% endif %}

   <!-- Comments Section -->
   <div style="margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px;">
     <h2>Comments</h2>

     <!-- Comment Form -->
     {% if user.is_authenticated %}
     <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
       <h4>Add a comment</h4>
       <form method="post">
         {% csrf_token %}
         {{ comment_form.as_p }}
         <button type="submit" name="comment_submit" style="
           padding: 8px 16px;
           font-size: 14px;
           font-weight: bold;
           border: none;
           border-radius: 8px;
           cursor: pointer;
           background-color: #e6f0ff;
           color: #003366;
         ">Post Comment</button>
       </form>
     </div>
     {% else %}
     <p><a href="{% url 'login' %}?next={% url 'book_detail' book.id %}">Log in</a> to leave a comment.</p>
     {% endif %}

     <!-- Comments Display -->
     <div style="margin-top: 20px;">
       {% if comments %}
         {% for comment in comments %}
         <div style="border-bottom: 1px solid #e0e0e0; padding: 15px 0;">
           <div style="display: flex; justify-content: space-between; color: #6c757d; margin-bottom: 5px;">
             <strong>{{ comment.user.username }}</strong>
             <small>{{ comment.date_added }}</small>
           </div>
           <div style="margin-top: 5px;">
             <p>{{ comment.body }}</p>
           </div>
         </div>
         {% endfor %}
       {% else %}
         <p>No comments yet. Be the first to comment!</p>
       {% endif %}
     </div>
   </div>

   <br><br>
   <a href="{% url 'displaybooks' %}">‚Üê Back to all books</a>
{% endblock content %}