{% extends "base.html" %}
{% load static %}

{% block sidenav %}
   {% for item in item_list %}
      <li>
        <a href="{{ item.link }}">  {{ item.item }} </a>
      </li>
   {% endfor %}
{% endblock sidenav %}

{% block content %}
   <h1>Book Detail</h1>
   <table border="2" >
      <tr>
          <th>
              Book Picture
          </th>
          <th>
              Book Name
          </th>
          <th>
              Book Price
          </th>
          <th>
              User Name
          </th>
          <th>
              Book Post Date
          </th>
          <th>
              Book Web
          </th>
      </tr>
       <tr>
         <td>
           <img src="{% static book.pic_path %}" width="100" />
         </td>
         <td>
            {{ book.name }}
         </td>
         <td>
            {{ book.price }}
         </td>
          <td>
            {{ book.username }}
         </td>
           <td>
            {{ book.publishdate }}
         </td>
         <td>
               {{ book.web }}
         </td>
      </tr>
   </table>

    {% if user.is_authenticated %}
  <form action="{% url 'toggle_favorite' book_id=book.id %}" method="post" style="margin-top: 20px;">
    {% csrf_token %}
    <button type="submit" style="
      padding: 10px 16px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: {% if is_favorite %}#ffe6e6{% else %}#e6f0ff{% endif %};
      color: {% if is_favorite %}#cc0000{% else %}#003366{% endif %};
      transition: 0.3s;
    ">
      {% if is_favorite %}
        ‚ù§Ô∏è Favorited ‚Äî Click to Remove
      {% else %}
        ü§ç Add to Favorites
      {% endif %}
    </button>
  </form>
{% endif %}

   <div style="margin-top: 30px; margin-bottom: 30px;">
      <h2>Comments</h2>

      {% if comments %}
         <div style="margin-bottom: 20px;">
            {% for comment in comments %}
               <div style="margin-bottom: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
                  <div style="font-weight: bold;">{{ comment.user.username }}</div>
                   <div style="font-size: 0.8em; color: #666; margin-bottom: 8px;">{{ comment.created_date|date:"F j, Y" }}</div>
                   <div>{{ comment.text }}</div>
               </div>
            {% endfor %}
         </div>
      {% else %}
         <p>No comments yet. Be the first to comment!</p>
      {% endif %}

      <div style="margin-top: 20px;">

         {% if user.is_authenticated %}
            <form method="post" action="">
               {% csrf_token %}
               <div style="margin-bottom: 10px;">
                  {{ comment_form.text }}
               </div>
               <button type="submit" style="
                  padding: 8px 16px;
                  font-size: 14px;
                  font-weight: bold;
                  border: none;
                  border-radius: 8px;
                  cursor: pointer;
                  background-color: #e6f0ff;
                  color: #003366;
               ">Submit Comment</button>
            </form>
         {% endif %}
      </div>
   </div>

   <br><br>
   <a href="{% url 'displaybooks' %}">‚Üê Back to all books</a>
{% endblock content %}